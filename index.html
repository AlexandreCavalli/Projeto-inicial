<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Or√ßamento APS</title>
<link rel="stylesheet" href="style.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">


</head>

<body>
    <button onclick="toggleDarkMode()" id="btnDark">
    üåô Modo escuro
</button>

<div class="input-box">
<strong>C√°lculo Or√ßamento Cortinas</strong><br><br>

<label>Cliente:</label>
<input type="text" id="cliente"><br><br>

<label>Largura (cm):</label>
<input type="number" id="largura"><br><br>

<label>Altura (cm):</label>
<input type="number" id="altura"><br><br>

<label>Modelo da tira:</label>
<select id="tira">
    <option value="12">Perfurada 0,80</option>
    <option value="10">Perfurada 0,60</option>
    <option value="11">Lisa 0,80</option>
    <option value="9">Lisa 0,70</option>
</select><br><br>

<label>Kit guia:</label>
<select id="kitTipo">
    <option value="230">Kit 100</option>
    <option value="280">Kit 130</option>
</select>
<input type="number" id="kitQtd" placeholder="Digite a qtd de guias" ><br><br>

<label>Com pintura ep√≥xi:</label>
<input type="checkbox" id="pintura"><br><br>

<label>Pagamento 3x cart√£o (9%):</label>
<input type="checkbox" id="cartao"><br><br>

<label>Centrais:</label>
<input type="number" id="centrais" ><br><br>

<label>M√£o de obra (R$):</label>
<input type="number" id="mao" ><br><br>

<div class="botoes-container">
    <div class="botoes-esquerda">
        <button onclick="calcular()">Calcular</button>
        <button onclick="limpar()">Limpar</button>
    </div>
    <div class="botoes-direita">
        <button onclick="salvarOrcamento()">Salvar</button>
        <button onclick="imprimir()">Enviar Cliente</button>
    </div>
</div>

<div id="msgSalvo" style="display:none;color:green;margin-top:10px;font-weight:bold">
‚úî Or√ßamento salvo no hist√≥rico
</div>
</div>

<div id="resultado" class="resultado-box"></div>

<div id="historicoBox" class="historico-box">
<strong>Hist√≥rico de Or√ßamentos</strong><br><br>
<button onclick="toggleExcluir()">Gerenciar hist√≥rico</button><br><br>
<div id="historico"></div>
</div>

<button class="botao-historico" onclick="toggleHistorico()">üìÑ Hist√≥rico</button>

<script>
let ultimoOrcamento = null;
let modoExcluir = false;

function moeda(v) {
    return v.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
}

function calcular() {
    const cliente = document.getElementById("cliente").value;
    const largura = Number(document.getElementById("largura").value);
    const altura = Number(document.getElementById("altura").value);

    if (!cliente || !largura || !altura) {
        alert("Preencha cliente, largura e altura.");
        return;
    }

    const larguraM = largura / 100;
    const area = (largura * altura) / 10000;

    const regras = [
        { ate: 10, motor: 200, preco: 800, eixo: "4,5", soleira: "30 x 50" },
        { ate: 14, motor: 300, preco: 900, eixo: "4,5", soleira: "30 x 50" },
        { ate: 20, motor: 500, preco: 1000, eixo: "5,5", soleira: "40 x 60" },
        { ate: 25, motor: 600, preco: 1150, eixo: "5,5", soleira: "40 x 60" },
        { ate: 30, motor: 800, preco: 2250, eixo: "8.0", soleira: "40 x 80" },
        { ate: 36, motor: 1000, preco: 2750, eixo: "8.0", soleira: "40 x 80" },
        { ate: 49, motor: 1500, preco: 4250, eixo: "8.0", soleira: "40 x 80" },
        { ate: 60, motor: 2000, preco: 5500, eixo: "8.0", soleira: "40 x 80" }
    ];

    const regra = regras.find(r => area <= r.ate);

    const eixoValor = { "4,5": 60, "5,5": 85, "8.0": 163 };
    const soleiraValor = { "30 x 50": 25, "40 x 60": 30, "40 x 80": 35 };

    const valorEixo = larguraM * eixoValor[regra.eixo];
    const valorSoleira = larguraM * soleiraValor[regra.soleira];

    const tiras = Math.ceil(altura / 7.5);
    const valorTiras = tiras * larguraM * Number(document.getElementById("tira").value);

    const valorKit = Number(document.getElementById("kitQtd").value) * Number(document.getElementById("kitTipo").value);
    const pintura = document.getElementById("pintura").checked ? area * 70 : 0;
    const centrais = Number(document.getElementById("centrais").value) * 250;
    const mao = Number(document.getElementById("mao").value);
    const cobreRolo = larguraM * 200;

    const subtotalItens =
        regra.preco + valorEixo + valorSoleira + valorTiras +
        valorKit + pintura + centrais + mao + cobreRolo;

    const nf = subtotalItens * 0.10;
    const subtotal = subtotalItens + nf;
    const taxaCartao = document.getElementById("cartao").checked ? subtotal * 0.09 : 0;
    const total = subtotal + taxaCartao;

    document.getElementById("resultado").innerHTML = `
    
    <table>
        <tr><td class="desc">Motor ${regra.motor} kg</td><td class="valor">${moeda(regra.preco)}</td></tr>
        <tr><td class="desc">Eixo ${regra.eixo}"</td><td class="valor">${moeda(valorEixo)}</td></tr>
        <tr><td class="desc">Soleira ${regra.soleira}</td><td class="valor">${moeda(valorSoleira)}</td></tr>
        <tr><td class="desc">Tiras (${tiras} un.)</td><td class="valor">${moeda(valorTiras)}</td></tr>
        <tr><td class="desc">Kit guia</td><td class="valor">${moeda(valorKit)}</td></tr>
        <tr><td class="desc">Cobre rolo</td><td class="valor">${moeda(cobreRolo)}</td></tr>
        <tr><td class="desc">Pintura ep√≥xi</td><td class="valor">${moeda(pintura)}</td></tr>
        <tr><td class="desc">Centrais</td><td class="valor">${moeda(centrais)}</td></tr>
        <tr><td class="desc">M√£o de obra</td><td class="valor">${moeda(mao)}</td></tr>
        <tr class="linha-nf"><td class="desc">Nota Fiscal (10%)</td><td class="valor">${moeda(nf)}</td></tr>
        <tr><td class="desc">Taxa cart√£o (9%)</td><td class="valor">${moeda(taxaCartao)}</td></tr>
        <tr class="linha-total"><td class="desc">TOTAL</td><td class="valor">${moeda(total)}</td></tr>
    </table>`;

    const agora = new Date();
    ultimoOrcamento = {
        cliente,
        data: agora.toLocaleDateString("pt-BR") + " " +
              agora.toLocaleTimeString("pt-BR", { hour: "2-digit", minute: "2-digit" }),
        total
    };
}

function salvarOrcamento() {
    if (!ultimoOrcamento) return;
    const lista = JSON.parse(localStorage.getItem("orcamentos") || "[]");
    lista.push(ultimoOrcamento);
    localStorage.setItem("orcamentos", JSON.stringify(lista));
    carregarHistorico();
    document.getElementById("msgSalvo").style.display = "block";
    setTimeout(() => document.getElementById("msgSalvo").style.display = "none", 2000);
}

function carregarHistorico() {
    const lista = JSON.parse(localStorage.getItem("orcamentos") || "[]");
    const h = document.getElementById("historico");
    h.innerHTML = "";
    lista.forEach((o, i) => {
        h.innerHTML += `
        <div class="historico-item">
            ${o.cliente} ‚Äì ${o.data} ‚Äì ${moeda(o.total)}
            <button class="btn-excluir" onclick="excluir(${i})">Excluir</button>
        </div>`;
    });
    atualizarExcluir();
}



function toggleHistorico() {
    const box = document.getElementById("historicoBox");
    box.style.display = box.style.display === "none" ? "block" : "none";
}

function toggleExcluir() {
    modoExcluir = !modoExcluir;
    atualizarExcluir();
}

function atualizarExcluir() {
    document.querySelectorAll(".btn-excluir").forEach(b =>
        b.style.display = modoExcluir ? "inline-block" : "none"
    );
}

function excluir(i) {
    if (!confirm("Excluir or√ßamento?")) return;
    const lista = JSON.parse(localStorage.getItem("orcamentos"));
    lista.splice(i, 1);
    localStorage.setItem("orcamentos", JSON.stringify(lista));
    carregarHistorico();
}

function toggleDarkMode() {
    document.body.classList.toggle('dark');

    const isDark = document.body.classList.contains('dark');
    localStorage.setItem('tema', isDark ? 'dark' : 'light');

    document.getElementById('btnDark').innerText =
        isDark ? '‚òÄÔ∏è Modo claro' : 'üåô Modo escuro';
}

/* Carrega prefer√™ncia salva */
window.onload = () => {
    if (localStorage.getItem('tema') === 'dark') {
        document.body.classList.add('dark');
        document.getElementById('btnDark').innerText = '‚òÄÔ∏è Modo claro';
    }
};

function limpar() {
    document.querySelectorAll("input").forEach(i => {
        if (i.type === "checkbox") i.checked = false;
        else i.value = "";
    });
    document.getElementById("resultado").innerHTML = "";
    ultimoOrcamento = null;
}



carregarHistorico()

function imprimir() {
    const resultado = document.getElementById("resultado");
    const clientee = document.getElementById('cliente').value;
    

    if (!resultado.innerHTML.trim()) {
        alert("Calcule o or√ßamento antes de imprimir.");
        return;
    }

    // guarda o conte√∫do original da p√°gina
    const original = document.body.innerHTML;

    // troca a p√°gina inteira s√≥ pelo resultado
    document.body.innerHTML = `
        <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="container">
        <div>
            
            <div id="vermelho">AC/ ${clientee}</div>
            <u>APS - SolucÃßoÃÉes em Serralheria</u>
            <p>Rua Jos√© Argenta, 127 ‚Äì Caxias do Sul ‚Äì RS </p>
            <p>&#128383; 54 3227 2755 / 99978 7453 </p>
            <a href="">contato@apsserralheria.com.br</a>
            <p>www.apsserralheria.com.br</p>
            <img src="images.jpg" alt="" width="150px">
            <div id="orcamento">Or√ßamento</div>
        <div style="padding:20px;font-family:Arial">
            ${resultado.innerHTML}
        </div>
        <h3>Valor Or√ßado: ${moeda(ultimoOrcamento.total)}</h3>
            <br>
            <p>- Pagamento a vista: Entrada de 50% e restante na entrega</p>
            <p>- Desconto para pagamento a vista de 8% R$</p>
            <p>- Em at√© 12x no cart√£o com juros da m√°quina </p>
            <p>- Or√ßamento valido por 10 dias.</p>

            <br>
            <p>PORTA DE A√áO AUTOM√ÅTICA, em chapa <b>transvision</b> espessura 0,80 galvanizada, MEIA-CANA com terminal com refor√ßo em tubo, guias laterais de 60 x 90 mm, eixo tubo de a√ßo 4.1/2‚Äùpolegadas, com pontas de a√ßo maci√ßo,  MOTOR, (monof√°sico) 220 w 1720 RPM com capacidade de carga de 300 kg, freio eletromagn√©tico, fim de curso, limitadores de paradas autom√°ticas, com acionamento atrav√©s de controle remoto e botoeira com tr√™s comandos (abre, para e fecha), sistema de correntes (talha manual) para emerg√™ncia na falta de energia el√©trica. Garantia de 1 ano. <b>Fabrica√ß√£o pr√≥pria.</b>
            Instala√ß√£o no local determinado no prazo de 12 dias para cortinas sem pintura e 22 dias para cortinas com pintura.
            <br><br>
            </p>
            <h4>Responsabilidade do cliente:</h4>
            <br>
            <p>- Deixar o local limpo e livre para o dia da instala√ß√£o, caso haja algum objeto que impe√ßa a instala√ß√£o, a mesma ser√° reagendada para os pr√≥ximos 15dias.</p>
            <p>- Deixar um ponto de energia para ligar o motor.</p>
            <p>- Instala√ß√£o ou condu√ß√£o da botoeira, tomada e el√©trica fica por conta do propriet√°rio.</p>
            <p>- Caso o cliente opte por outra forma de esconder o rolo e motor, ser√£o necess√°rios dois acessos de 50x50cm para eventuais manuten√ß√µes.</p>
            <br>

            <h4>ALGUNS DE NOSSOS CLIENTES</h4>
            <img src="imagem-clientes.png" alt="" width="800px">
    `;

    window.print();

    // volta a p√°gina ao normal
    document.body.innerHTML = original;
}
</script>

</body>
</html>