<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Or√ßamento APS</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 20px;
    font-size: 14px;
}

.input-box, .resultado-box, .historico-box {
    border: 1px solid #ccc;
    padding: 15px;
    background: #f9f9f9;
    max-width: 650px;
    margin: 0 auto 20px auto;
}

label {
    display: inline-block;
    width: 180px;
}

button {
    padding: 8px 14px;
    cursor: pointer;
}

table {
    width: 100%;
    border-collapse: collapse;
}

td {
    padding: 6px 4px;
}

.desc { width: 65%; }
.valor { width: 35%; text-align: right; }

.linha-nf td {
    border-top: 1px dashed #999;
}

.linha-total td {
    border-top: 2px solid #b30000;
    color: #b30000;
    font-weight: bold;
    font-size: 18px;
}

/* BOT√ïES */
.botoes-container {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
}

.botoes-esquerda button {
    margin-right: 5px;
}

.botoes-direita {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

/* HIST√ìRICO */
.historico-box {
    display: none;
}

.historico-item {
    border-bottom: 1px solid #ddd;
    padding: 6px 0;
}

.btn-excluir {
    background: #b30000;
    color: white;
    border: none;
    padding: 3px 8px;
    font-size: 11px;
    cursor: pointer;
    display: none;
    margin-left: 10px;
}

/* BOT√ÉO HIST√ìRICO FLUTUANTE */
.botao-historico {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #b30000;
    color: white;
    border: none;
    padding: 12px 18px;
    border-radius: 50px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}
</style>
</head>

<body>

<div class="input-box">
<strong>C√°lculo do or√ßamento</strong><br><br>

<label>Cliente:</label>
<input type="text" id="cliente"><br><br>

<label>Largura (cm):</label>
<input type="number" id="largura"><br><br>

<label>Altura (cm):</label>
<input type="number" id="altura"><br><br>

<label>Modelo da tira:</label>
<select id="tira">
    <option value="12">Perfurada 0,80</option>
    <option value="10">Perfurada 0,60</option>
    <option value="11">Lisa 0,80</option>
    <option value="9">Lisa 0,70</option>
</select><br><br>

<label>Kit guia:</label>
<select id="kitTipo">
    <option value="230">Kit 100</option>
    <option value="280">Kit 130</option>
</select>
<input type="number" id="kitQtd" value="0"><br><br>

<label>Com pintura ep√≥xi:</label>
<input type="checkbox" id="pintura"><br><br>

<label>Pagamento 3x cart√£o (9%):</label>
<input type="checkbox" id="cartao"><br><br>

<label>Centrais:</label>
<input type="number" id="centrais" value="0"><br><br>

<label>M√£o de obra (R$):</label>
<input type="number" id="mao" value="0"><br><br>

<div class="botoes-container">
    <div class="botoes-esquerda">
        <button onclick="calcular()">Calcular</button>
        <button onclick="limpar()">Limpar</button>
    </div>

    <div class="botoes-direita">
        <button onclick="salvarOrcamento()">Salvar</button>
    </div>
</div>

<div id="msgSalvo" style="display:none;color:green;margin-top:10px;font-weight:bold">
‚úî Or√ßamento salvo no hist√≥rico
</div>
</div>

<div id="resultado" class="resultado-box"></div>

<div id="historicoBox" class="historico-box">
<strong>Hist√≥rico de Or√ßamentos</strong><br><br>
<button onclick="toggleExcluir()">Gerenciar hist√≥rico</button><br><br>
<div id="historico"></div>
</div>

<button class="botao-historico" onclick="toggleHistorico()">üìÑ Hist√≥rico</button>

<script>
let ultimoOrcamento = null;
let modoExcluir = false;

function moeda(v) {
    return v.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
}

function calcular() {

    const cliente = document.getElementById("cliente").value;
    const largura = Number(document.getElementById("largura").value);
    const altura = Number(document.getElementById("altura").value);

    if (!cliente || !largura || !altura) {
        alert("Preencha cliente, largura e altura.");
        return;
    }

    const larguraM = largura / 100;
    const area = (largura * altura) / 10000;

    const regras = [
        { ate: 10, motor: 200, preco: 800, eixo: "4,5", soleira: "30 x 50" },
        { ate: 14, motor: 300, preco: 900, eixo: "4,5", soleira: "30 x 50" },
        { ate: 20, motor: 500, preco: 1000, eixo: "5,5", soleira: "40 x 60" },
        { ate: 25, motor: 600, preco: 1150, eixo: "5,5", soleira: "40 x 60" },
        { ate: 30, motor: 800, preco: 2250, eixo: "8.0", soleira: "40 x 80" },
        { ate: 36, motor: 1000, preco: 2750, eixo: "8.0", soleira: "40 x 80" },
        { ate: 49, motor: 1500, preco: 4250, eixo: "8.0", soleira: "40 x 80" },
        { ate: 60, motor: 2000, preco: 5500, eixo: "8.0", soleira: "40 x 80" }
    ];

    const regra = regras.find(r => area <= r.ate);

    const eixoValor = { "4,5": 60, "5,5": 85, "8.0": 163 };
    const soleiraValor = { "30 x 50": 25, "40 x 60": 30, "40 x 80": 35 };

    const valorEixo = larguraM * eixoValor[regra.eixo];
    const valorSoleira = larguraM * soleiraValor[regra.soleira];

    const tiras = Math.ceil(altura / 7.5);
    const valorTiras = tiras * larguraM * Number(document.getElementById("tira").value);

    const valorKit = Number(document.getElementById("kitQtd").value) * Number(document.getElementById("kitTipo").value);
    const pintura = document.getElementById("pintura").checked ? area * 70 : 0;
    const centrais = Number(document.getElementById("centrais").value) * 250;
    const mao = Number(document.getElementById("mao").value);
    const cobreRolo = larguraM * 200;

    const subtotalItens =
        regra.preco + valorEixo + valorSoleira + valorTiras +
        valorKit + pintura + centrais + mao + cobreRolo;

    const nf = subtotalItens * 0.10;
    const subtotal = subtotalItens + nf;
    const taxaCartao = document.getElementById("cartao").checked ? subtotal * 0.09 : 0;
    const total = subtotal + taxaCartao;

    document.getElementById("resultado").innerHTML = `
    <table>
        <tr><td class="desc">Motor ${regra.motor} kg</td><td class="valor">${moeda(regra.preco)}</td></tr>
        <tr><td class="desc">Eixo ${regra.eixo}"</td><td class="valor">${moeda(valorEixo)}</td></tr>
        <tr><td class="desc">Soleira ${regra.soleira}</td><td class="valor">${moeda(valorSoleira)}</td></tr>
        <tr><td class="desc">Tiras (${tiras} un.)</td><td class="valor">${moeda(valorTiras)}</td></tr>
        <tr><td class="desc">Kit guia</td><td class="valor">${moeda(valorKit)}</td></tr>
        <tr><td class="desc">Cobre rolo</td><td class="valor">${moeda(cobreRolo)}</td></tr>
        <tr><td class="desc">Pintura ep√≥xi</td><td class="valor">${moeda(pintura)}</td></tr>
        <tr><td class="desc">Centrais</td><td class="valor">${moeda(centrais)}</td></tr>
        <tr><td class="desc">M√£o de obra</td><td class="valor">${moeda(mao)}</td></tr>
        <tr class="linha-nf"><td class="desc">Nota Fiscal (10%)</td><td class="valor">${moeda(nf)}</td></tr>
        <tr><td class="desc">Taxa cart√£o (9%)</td><td class="valor">${moeda(taxaCartao)}</td></tr>
        <tr class="linha-total"><td class="desc">TOTAL</td><td class="valor">${moeda(total)}</td></tr>
    </table>`;

    const agora = new Date();
    ultimoOrcamento = {
        cliente,
        data: agora.toLocaleDateString("pt-BR") + " " +
              agora.toLocaleTimeString("pt-BR", { hour: "2-digit", minute: "2-digit" }),
        total
    };
}

function salvarOrcamento() {
    if (!ultimoOrcamento) return;
    const lista = JSON.parse(localStorage.getItem("orcamentos") || "[]");
    lista.push(ultimoOrcamento);
    localStorage.setItem("orcamentos", JSON.stringify(lista));
    carregarHistorico();
    document.getElementById("msgSalvo").style.display = "block";
    setTimeout(() => document.getElementById("msgSalvo").style.display = "none", 2000);
}

function carregarHistorico() {
    const lista = JSON.parse(localStorage.getItem("orcamentos") || "[]");
    const h = document.getElementById("historico");
    h.innerHTML = "";
    lista.forEach((o, i) => {
        h.innerHTML += `
        <div class="historico-item">
            ${o.cliente} ‚Äì ${o.data} ‚Äì ${moeda(o.total)}
            <button class="btn-excluir" onclick="excluir(${i})">Excluir</button>
        </div>`;
    });
    atualizarExcluir();
}

function toggleHistorico() {
    const box = document.getElementById("historicoBox");
    box.style.display = box.style.display === "none" ? "block" : "none";
}

function toggleExcluir() {
    modoExcluir = !modoExcluir;
    atualizarExcluir();
}

function atualizarExcluir() {
    document.querySelectorAll(".btn-excluir").forEach(b =>
        b.style.display = modoExcluir ? "inline-block" : "none"
    );
}

function excluir(i) {
    if (!confirm("Excluir or√ßamento?")) return;
    const lista = JSON.parse(localStorage.getItem("orcamentos"));
    lista.splice(i, 1);
    localStorage.setItem("orcamentos", JSON.stringify(lista));
    carregarHistorico();
}

function limpar() {
    document.querySelectorAll("input").forEach(i => {
        if (i.type === "checkbox") i.checked = false;
        else i.value = "";
    });
    document.getElementById("resultado").innerHTML = "";
    ultimoOrcamento = null;
}

carregarHistorico();
</script>

</body>
</html>
